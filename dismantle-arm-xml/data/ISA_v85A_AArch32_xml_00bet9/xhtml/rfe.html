<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" type="text/css" href="insn.css" /><meta name="generator" content="iform.xsl" /><title>RFE, RFEDA, RFEDB, RFEIA, RFEIB -- AArch32</title></head><body><table align="center"><tr><td><div class="topbar"><a href="index.html">Base Instructions</a></div></td><td><div class="topbar"><a href="fpsimdindex.html">SIMD&amp;FP Instructions</a></div></td><td><div class="topbar"><a href="a32_encindex.html">A32 Instructions by Encoding</a></div></td><td><div class="topbar"><a href="t32_encindex.html">T32 Instructions by Encoding</a></div></td><td><div class="topbar"><a href="shared_pseudocode.html">Shared Pseudocode</a></div></td><td><div class="topbar"><a href="notice.html">Proprietary Notice</a></div></td></tr></table><hr /><h2 class="instruction-section">RFE, RFEDA, RFEDB, RFEIA, RFEIB</h2><p id="desc">
      <p class="aml">Return From Exception loads two consecutive memory locations using an address in a base register:</p>
      <ul>
        <li>The word loaded from the lower address is treated as an instruction address. The PE branches to it.</li>
        <li>The word loaded from the higher address is used to restore <a class="armarm-xref" title="Reference to Armv8 ARM section">PSTATE</a>. This word must be in the format of an SPSR.</li>
      </ul>
      <p class="aml">An address adjusted by the size of the data loaded can optionally be written back to the base register.</p>
      <p class="aml">The PE checks the value of the word loaded from the higher address for an illegal return event. See <a class="armarm-xref" title="Reference to Armv8 ARM section">Illegal return events from AArch32 state</a>.</p>
      <p class="aml"><span class="asm-code">RFE</span> is <span class="arm-defined-word">undefined</span> in Hyp mode and <span class="arm-defined-word">constrained unpredictable</span> in User mode.</p>
    </p>
    <p class="desc">
      It has encodings from the following instruction sets:
       A32 (
      <a href="#a1">A1</a>
      )
       and 
       T32 (
      <a href="#t1">T1</a>
       and 
      <a href="#t2">T2</a>
      )
      .
    </p>
    <h3 class="classheading"><a name="a1" id="a1"></a>A1</h3><p class="desc"></p><div class="regdiagram-32"><table class="regdiagram"><thead><tr><td>31</td><td>30</td><td>29</td><td>28</td><td>27</td><td>26</td><td>25</td><td>24</td><td>23</td><td>22</td><td>21</td><td>20</td><td>19</td><td>18</td><td>17</td><td>16</td><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr></thead><tbody><tr class="firstrow"><td class="l">1</td><td>1</td><td>1</td><td>1</td><td>1</td><td>0</td><td class="r">0</td><td class="lr">P</td><td class="lr">U</td><td class="lr">0</td><td class="lr">W</td><td class="lr">1</td><td colspan="4" class="lr">Rn</td><td class="l">(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(1)</td><td>(0)</td><td>(1)</td><td>(0)</td><td>(0)</td><td>(0)</td><td class="r">(0)</td><td class="l">(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td class="r">(0)</td></tr></tbody></table></div><div class="encoding"><h4 class="encoding">Decrement After<span class="bitdiff"> (P == 0 &amp;&amp; U == 0)</span></h4><p class="asm-code"><a name="RFEDA_A1_AS" id="RFEDA_A1_AS"></a>RFEDA{<a href="#c_1" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;c&gt;</a>}{<a href="#q" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;q&gt;</a>} <a href="#rn" title="General-purpose base register (field &quot;Rn&quot;)">&lt;Rn&gt;</a><a href="#0d33" title="The address adjusted by the size of data loaded is written back to the base register (field &quot;W&quot;)">{!}</a></p></div><div class="encoding"><h4 class="encoding">Decrement Before<span class="bitdiff"> (P == 1 &amp;&amp; U == 0)</span></h4><p class="asm-code"><a name="RFEDB_A1_AS" id="RFEDB_A1_AS"></a>RFEDB{<a href="#c_1" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;c&gt;</a>}{<a href="#q" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;q&gt;</a>} <a href="#rn" title="General-purpose base register (field &quot;Rn&quot;)">&lt;Rn&gt;</a><a href="#0d33" title="The address adjusted by the size of data loaded is written back to the base register (field &quot;W&quot;)">{!}</a></p></div><div class="encoding"><h4 class="encoding">Increment After<span class="bitdiff"> (P == 0 &amp;&amp; U == 1)</span></h4><p class="asm-code"><a name="RFEIA_A1_AS" id="RFEIA_A1_AS"></a>RFE<a href="#ia_1" title="Optional suffix to indicate the Increment After variant">{IA}</a>{<a href="#c_1" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;c&gt;</a>}{<a href="#q" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;q&gt;</a>} <a href="#rn" title="General-purpose base register (field &quot;Rn&quot;)">&lt;Rn&gt;</a><a href="#0d33" title="The address adjusted by the size of data loaded is written back to the base register (field &quot;W&quot;)">{!}</a></p></div><div class="encoding"><h4 class="encoding">Increment Before<span class="bitdiff"> (P == 1 &amp;&amp; U == 1)</span></h4><p class="asm-code"><a name="RFEIB_A1_AS" id="RFEIB_A1_AS"></a>RFEIB{<a href="#c_1" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;c&gt;</a>}{<a href="#q" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;q&gt;</a>} <a href="#rn" title="General-purpose base register (field &quot;Rn&quot;)">&lt;Rn&gt;</a><a href="#0d33" title="The address adjusted by the size of data loaded is written back to the base register (field &quot;W&quot;)">{!}</a></p></div><p class="pseudocode">n = <a href="shared_pseudocode.html#impl-shared.UInt.1" title="function: integer UInt(bits(N) x)">UInt</a>(Rn);
wback = (W == '1');  increment = (U == '1');  wordhigher = (P == U);
if n == 15 then UNPREDICTABLE;</p>
    <h3 class="classheading"><a name="t1" id="t1"></a>T1</h3><div class="regdiagram-16x2"><table class="regdiagram"><thead><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr></thead><tbody><tr class="firstrow"><td class="l">1</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td><td class="r">0</td><td class="l">0</td><td class="r">0</td><td class="lr">0</td><td class="lr">W</td><td class="lr">1</td><td colspan="4" class="lr">Rn</td><td class="lr">(1)</td><td class="lr">(1)</td><td class="l">(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td class="r">(0)</td></tr></tbody></table></div><div class="encoding"><h4 class="encoding">T1</h4><p class="asm-code"><a name="RFE_T1_AS" id="RFE_T1_AS"></a>RFEDB{<a href="#c" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;c&gt;</a>}{<a href="#q" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;q&gt;</a>} <a href="#rn" title="General-purpose base register (field &quot;Rn&quot;)">&lt;Rn&gt;</a><a href="#0d33" title="The address adjusted by the size of data loaded is written back to the base register (field &quot;W&quot;)">{!}</a>
        //
      
        (Outside or last in IT block)
      </p></div><p class="pseudocode">n = <a href="shared_pseudocode.html#impl-shared.UInt.1" title="function: integer UInt(bits(N) x)">UInt</a>(Rn);  wback = (W == '1');  increment = FALSE;  wordhigher = FALSE;
if n == 15 then UNPREDICTABLE;
if <a href="shared_pseudocode.html#impl-aarch32.InITBlock.0" title="function: boolean InITBlock()">InITBlock</a>() &amp;&amp; !<a href="shared_pseudocode.html#impl-aarch32.LastInITBlock.0" title="function: boolean LastInITBlock()">LastInITBlock</a>() then UNPREDICTABLE;</p>
    <h3 class="classheading"><a name="t2" id="t2"></a>T2</h3><div class="regdiagram-16x2"><table class="regdiagram"><thead><tr><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td><td>15</td><td>14</td><td>13</td><td>12</td><td>11</td><td>10</td><td>9</td><td>8</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr></thead><tbody><tr class="firstrow"><td class="l">1</td><td>1</td><td>1</td><td>0</td><td>1</td><td>0</td><td class="r">0</td><td class="l">1</td><td class="r">1</td><td class="lr">0</td><td class="lr">W</td><td class="lr">1</td><td colspan="4" class="lr">Rn</td><td class="lr">(1)</td><td class="lr">(1)</td><td class="l">(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td>(0)</td><td class="r">(0)</td></tr></tbody></table></div><div class="encoding"><h4 class="encoding">T2</h4><p class="asm-code"><a name="RFE_T2_AS" id="RFE_T2_AS"></a>RFE<a href="#ia" title="Optional suffix for Increment After form">{IA}</a>{<a href="#c" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;c&gt;</a>}{<a href="#q" title="See {xref{ARMARM_Babbefhf}{Standard assembler syntax fields}}">&lt;q&gt;</a>} <a href="#rn" title="General-purpose base register (field &quot;Rn&quot;)">&lt;Rn&gt;</a><a href="#0d33" title="The address adjusted by the size of data loaded is written back to the base register (field &quot;W&quot;)">{!}</a>
        //
      
        (Outside or last in IT block)
      </p></div><p class="pseudocode">n = <a href="shared_pseudocode.html#impl-shared.UInt.1" title="function: integer UInt(bits(N) x)">UInt</a>(Rn);  wback = (W == '1');  increment = TRUE;  wordhigher = FALSE;
if n == 15 then UNPREDICTABLE;
if <a href="shared_pseudocode.html#impl-aarch32.InITBlock.0" title="function: boolean InITBlock()">InITBlock</a>() &amp;&amp; !<a href="shared_pseudocode.html#impl-aarch32.LastInITBlock.0" title="function: boolean LastInITBlock()">LastInITBlock</a>() then UNPREDICTABLE;</p>
  <p class="encoding-notes">
      <p class="aml">For more information about the <span class="arm-defined-word">constrained unpredictable</span> behavior of this instruction, see <a class="armarm-xref" title="Reference to Armv8 ARM section">Architectural Constraints on UNPREDICTABLE behaviors</a>.</p>
    </p><h3 class="explanations">Assembler Symbols</h3><div class="explanations"><table><col class="asyn-l" /><col class="asyn-r" /><tr><td>IA</td><td><a name="ia_1" id="ia_1"></a>
        
          
          
        
        
          <p class="aml">For encoding A1: is an optional suffix to indicate the Increment After variant.</p>
        
      </td></tr><tr><td></td><td><a name="ia" id="ia"></a>
        
          
          
        
        
          <p class="aml">For encoding T2: is an optional suffix for the Increment After form.</p>
        
      </td></tr></table><table><col class="asyn-l" /><col class="asyn-r" /><tr><td>&lt;c&gt;</td><td><a name="c_1" id="c_1"></a>
        
          
          
          
          
        
        
          <p class="aml">For encoding A1: see <a class="armarm-xref" title="Reference to Armv8 ARM section">Standard assembler syntax fields</a>. &lt;c&gt; must be AL or omitted.</p>
        
      </td></tr><tr><td></td><td><a name="c" id="c"></a>
        
          
        
        
          <p class="aml">For encoding T1 and T2: see <a class="armarm-xref" title="Reference to Armv8 ARM section">Standard assembler syntax fields</a>.</p>
        
      </td></tr></table><table><col class="asyn-l" /><col class="asyn-r" /><tr><td>&lt;q&gt;</td><td><a name="q" id="q"></a>
        
          <p class="aml">See <a class="armarm-xref" title="Reference to Armv8 ARM section">Standard assembler syntax fields</a>.</p>
        
      </td></tr></table><table><col class="asyn-l" /><col class="asyn-r" /><tr><td>&lt;Rn&gt;</td><td><a name="rn" id="rn"></a>
        
          <p class="aml">Is the general-purpose base register, encoded in the "Rn" field.</p>
        
      </td></tr></table><table><col class="asyn-l" /><col class="asyn-r" /><tr><td>!</td><td><a name="0d33" id="0d33"></a>
        
          <p class="aml">The address adjusted by the size of the data loaded is written back to the base register. If specified, it is encoded in the "W" field as 1, otherwise this field defaults to 0.</p>
        
      </td></tr></table></div><p class="syntax-notes">
      <p class="aml"><span class="asm-code">RFEFA</span>, <span class="asm-code">RFEEA</span>, <span class="asm-code">RFEFD</span>, and <span class="asm-code">RFEED</span> are pseudo-instructions for <span class="asm-code">RFEDA</span>, <span class="asm-code">RFEDB</span>, <span class="asm-code">RFEIA</span>, and <span class="asm-code">RFEIB</span> respectively, referring to their use for popping data from Full Ascending, Empty Ascending, Full Descending, and Empty Descending stacks.</p>
    </p>
    <div class="ps" psname="commonps"><a name="commonps" id="commonps"></a><h3 class="pseudocode">Operation</h3>
      <p class="pseudocode">if <a href="shared_pseudocode.html#impl-aarch32.ConditionPassed.0" title="function: boolean ConditionPassed()">ConditionPassed</a>() then
    EncodingSpecificOperations();
    if PSTATE.EL == <a href="shared_pseudocode.html#EL2" title="constant bits(2) EL2 = '10'">EL2</a> then
        UNDEFINED;
    elsif PSTATE.EL == <a href="shared_pseudocode.html#EL0" title="constant bits(2) EL0 = '00'">EL0</a> then
        UNPREDICTABLE;                        // UNDEFINED or NOP
    else
        address = if increment then <a href="shared_pseudocode.html#impl-aarch32.R.read.1" title="accessor: bits(32) R[integer n]">R</a>[n] else <a href="shared_pseudocode.html#impl-aarch32.R.read.1" title="accessor: bits(32) R[integer n]">R</a>[n]-8;
        if wordhigher then address = address+4;
        new_pc_value = <a href="shared_pseudocode.html#impl-aarch32.MemA.read.2" title="accessor: bits(8*size) MemA[bits(32) address, integer size]">MemA</a>[address,4];
        spsr = <a href="shared_pseudocode.html#impl-aarch32.MemA.read.2" title="accessor: bits(8*size) MemA[bits(32) address, integer size]">MemA</a>[address+4,4];
        if wback then <a href="shared_pseudocode.html#impl-aarch32.R.write.1" title="accessor: R[integer n] = bits(32) value">R</a>[n] = if increment then <a href="shared_pseudocode.html#impl-aarch32.R.read.1" title="accessor: bits(32) R[integer n]">R</a>[n]+8 else <a href="shared_pseudocode.html#impl-aarch32.R.read.1" title="accessor: bits(32) R[integer n]">R</a>[n]-8;
        <a href="shared_pseudocode.html#AArch32.ExceptionReturn.2" title="function: AArch32.ExceptionReturn(bits(32) new_pc, bits(32) spsr)">AArch32.ExceptionReturn</a>(new_pc_value, spsr);</p>
    </div>
  <h3>CONSTRAINED UNPREDICTABLE behavior</h3><p>If <span class="pseudocode">PSTATE.EL == EL0</span>, then one of the following behaviors must occur:</p><ul><li>The instruction is <span class="arm-defined-word">undefined</span>.</li><li>The instruction executes as <span class="asm-code">NOP</span>.</li></ul><hr /><table align="center"><tr><td><div class="topbar"><a href="index.html">Base Instructions</a></div></td><td><div class="topbar"><a href="fpsimdindex.html">SIMD&amp;FP Instructions</a></div></td><td><div class="topbar"><a href="a32_encindex.html">A32 Instructions by Encoding</a></div></td><td><div class="topbar"><a href="t32_encindex.html">T32 Instructions by Encoding</a></div></td><td><div class="topbar"><a href="shared_pseudocode.html">Shared Pseudocode</a></div></td><td><div class="topbar"><a href="notice.html">Proprietary Notice</a></div></td></tr></table><p class="versions">
      Internal version only: isa v00_88, pseudocode v85-xml-00bet9_rc1_1
      ; Build timestamp: 2018-12-12T12:33
    </p><p class="copyconf">
      Copyright © 2010-2018 Arm Limited or its affiliates. All rights reserved.
      This document is Non-Confidential.
    </p></body></html>
